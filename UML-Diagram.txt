@startuml

' VISUAL SETTINGS
skinparam linetype ortho
skinparam nodesep 60
skinparam ranksep 60
skinparam classAttributeIconSize 0

title SoundPlayer - Layered Architecture (Final Version)

' --- PRESENTATION LAYER ---
package "Presentation" {
    class ViewController {
        + start()
        - handleMainMenu()
        - handleSongsManagement()
        - handlePlaylistsManagement()
        - handlePlayback()
        - handleRandomAlbum()
    }

    class UI {
        + showMainMenu() : int
        + printMessage(msg : String)
        + readInput(prompt : String) : String
        + askForInt(prompt : String) : int
        + displaySongList(songs : List<Song>)
        + displayPlaylistDetails(p : Playlist)
        + readSongData() : Song
    }
}

' --- BUSINESS LAYER ---
package "Business" {
    
    package "Model" {
        enum Mood {
            HAPPY
            SAD
            RELAX
            ENERGETIC
        }

        class Song {
            - id : int
            - title : String
            - artist : String
            - durationSeconds : int
            - style : String
            - playable : boolean
            - notes : List<String>
            + getMood() : Mood
            + isPlayable() : boolean
            + toString() : String
        }

        class Playlist {
            - id : int
            - name : String
            - description : String
            - songIds : List<Integer>
            - duration : int
            + getTotalDuration(library : List<Song>) : int
            + getPlayableCount(library : List<Song>) : int
            + addSongId(id : int)
            + getDetailedString(library : List<Song>) : String
        }
    }

    package "Managers" {
        class LibraryManager {
            + getAllSongs() : List<Song>
            + addSong(song : Song)
            + deleteSong(id : int)
            + createPlaylist(p : Playlist)
            + addSongToPlaylist(pId : int, sId : int)
            + getAllPlaylists() : List<Playlist>
        }

        class AlbumGenerator {
            + generateRandomAlbum(mood : Mood, maxDuration : int) : Playlist
        }

        class PlaybackManager {
            + playSong(s : Song)
            + playPlaylist(p : Playlist, lib : LibraryManager)
        }
    }

    package "Audio" {
        abstract class SoundSynth {
            + {abstract} makeSound(freq : double, ms : int)
        }

        class SoundSynthSinus {
            + makeSound(freq : double, ms : int)
        }

        class SoundSynthSquare {
            + makeSound(freq : double, ms : int)
        }
    }
}

' --- PERSISTENCE LAYER ---
package "Persistence" {
    interface SongsDAO {
        + loadAll() : List<Song>
        + saveAll(songs : List<Song>)
    }

    interface PlaylistsDAO {
        + loadAll() : List<Playlist>
        + saveAll(playlists : List<Playlist>)
    }

    class JsonSongsDAO {
        - filePath : String
        - gson : Gson
    }

    class JsonPlaylistsDAO {
        - filePath : String
        - gson : Gson
    }
}

' --- CUSTOM EXCEPTIONS ---
package "CustomExceptions" {
    class Exception {
        (Java Standard)
    }
    
    class EmptyJsonFileException
    class InvalidInputException
    
    ' Children of EmptyJsonFileException
    class NoPlaylistsException
    class NoSongsException
    
    ' Children of NotFoundException
    class NotFoundException
    class PlaylistNotFoundException
    class SongNotFoundException
}

' --- RELATIONSHIPS ---

' Implementation & Inheritance
SoundSynth <|-- SoundSynthSinus
SoundSynth <|-- SoundSynthSquare
SongsDAO <|.. JsonSongsDAO
PlaylistsDAO <|.. JsonPlaylistsDAO

' Exception Inheritance
Exception <|-- EmptyJsonFileException
Exception <|-- InvalidInputException
Exception <|-- NotFoundException

' Logic: If the file is empty, it implies no songs/playlists found
EmptyJsonFileException <|-- NoPlaylistsException
EmptyJsonFileException <|-- NoSongsException

' Logic: Specific types of "Not Found"
NotFoundException <|-- PlaylistNotFoundException
NotFoundException <|-- SongNotFoundException

' Presentation Layer Relationships
ViewController --> UI : uses
ViewController --> LibraryManager : uses
ViewController --> PlaybackManager : uses
ViewController --> AlbumGenerator : uses

' Business Layer Relationships
LibraryManager --> SongsDAO : uses
LibraryManager --> PlaylistsDAO : uses
AlbumGenerator ..> LibraryManager : uses
PlaybackManager --> SoundSynth : uses

' Model Composition
Song *-- Mood
Playlist o-- Song : (Logic dependency)

' Persistence Dependencies
JsonSongsDAO ..> Song
JsonPlaylistsDAO ..> Playlist

' Exception Dependencies (High Level)
Persistence ..> EmptyJsonFileException : throws
Managers ..> NotFoundException : throws
UI ..> InvalidInputException : throws

@enduml